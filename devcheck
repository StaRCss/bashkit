#!/bin/bash
# ==========================================
# DevCheck - Daily Project Health 
# Portable Node Dev Environment Checker
# ==========================================

GREEN="\033[0;32m"
YELLOW="\033[1;33m"
RED="\033[0;31m"
CYAN="\033[0;36m"
NC="\033[0m"

echo -e "${CYAN}"
echo "=========================================="
echo "ðŸš€ DevCheck - Daily Dev Ritual"
echo "=========================================="
echo -e "${NC}"

# Check if inside Node project
if [ ! -f "package.json" ]; then
    echo -e "${RED}âŒ No package.json found."
    echo "Run inside a Node project."
    echo -e "${NC}"
    exit 1
fi

echo -e "${YELLOW}ðŸ§  Environment:${NC}"

echo "Node: $(node -v)"
echo "npm : $(npm -v)"

# Check for nvm
if command -v nvm &> /dev/null; then
    echo "nvm : $(nvm --version)"
fi

# Node engine requirement (if defined)
ENGINE=$(node -p "require('./package.json').engines?.node" 2>/dev/null)
if [ ! -z "$ENGINE" ]; then
    echo "Project requires Node: $ENGINE"
fi

echo
echo -e "${YELLOW}ðŸ” Security:${NC}"
npm audit --audit-level=moderate

echo
echo -e "${YELLOW}ðŸ“¦ Dependency Drift:${NC}"
npm outdated

echo
echo -e "${YELLOW}ðŸŒ¿ Git Status:${NC}"

BRANCH=$(git branch --show-current 2>/dev/null)
if [ ! -z "$BRANCH" ]; then
    echo "Branch: $BRANCH"

    if [ -n "$(git status --porcelain)" ]; then
        echo -e "${RED}âš  Uncommitted changes detected${NC}"
    else
        echo -e "${GREEN}âœ” Working tree clean${NC}"
    fi

    git fetch -q
    STATUS=$(git status -sb)
    echo "$STATUS"
fi

echo
echo -e "${YELLOW}ðŸ’¾ Disk Usage:${NC}"
df -h . | tail -1

echo
echo -e "${GREEN}=========================================="
echo "âœ… DevCheck Complete"
echo "=========================================="
echo -e "${NC}"